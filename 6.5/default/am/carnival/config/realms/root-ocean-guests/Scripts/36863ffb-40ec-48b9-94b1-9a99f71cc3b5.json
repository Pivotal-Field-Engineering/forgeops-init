{
  "metadata" : {
    "realm" : "/ocean/guests",
    "amsterVersion" : "5.5.0",
    "entityType" : "Scripts",
    "entityId" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "name" : "OIDC Claims Script",
    "description" : "Default global script for OIDC claims",
    "script" : "LyoKKiBUaGUgY29udGVudHMgb2YgdGhpcyBmaWxlIGFyZSBzdWJqZWN0IHRvIHRoZSB0ZXJtcyBvZiB0aGUgQ29tbW9uIERldmVsb3BtZW50IGFuZAoqIERpc3RyaWJ1dGlvbiBMaWNlbnNlICh0aGUgTGljZW5zZSkuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUKKiBMaWNlbnNlLgoqCiogWW91IGNhbiBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0IGxlZ2FsL0NEREx2MS4wLnR4dC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUKKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbiBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCioKKiBXaGVuIGRpc3RyaWJ1dGluZyBDb3ZlcmVkIFNvZnR3YXJlLCBpbmNsdWRlIHRoaXMgQ0RETCBIZWFkZXIgTm90aWNlIGluIGVhY2ggZmlsZSBhbmQgaW5jbHVkZQoqIHRoZSBMaWNlbnNlIGZpbGUgYXQgbGVnYWwvQ0RETHYxLjAudHh0LiBJZiBhcHBsaWNhYmxlLCBhZGQgdGhlIGZvbGxvd2luZyBiZWxvdyB0aGUgQ0RETAoqIEhlYWRlciwgd2l0aCB0aGUgZmllbGRzIGVuY2xvc2VkIGJ5IGJyYWNrZXRzIFtdIHJlcGxhY2VkIGJ5IHlvdXIgb3duIGlkZW50aWZ5aW5nCiogaW5mb3JtYXRpb246ICJQb3J0aW9ucyBjb3B5cmlnaHQgW3llYXJdIFtuYW1lIG9mIGNvcHlyaWdodCBvd25lcl0iLgoqCiogQ29weXJpZ2h0IDIwMTQtMjAxNSBGb3JnZVJvY2sgQVMuCiovCmltcG9ydCBjb20uaXBsYW5ldC5zc28uU1NPRXhjZXB0aW9uCmltcG9ydCBjb20uc3VuLmlkZW50aXR5LmlkbS5JZFJlcG9FeGNlcHRpb24KaW1wb3J0IG9yZy5mb3JnZXJvY2sub2F1dGgyLmNvcmUuVXNlckluZm9DbGFpbXMKaW1wb3J0IGNvbS5zdW4uaWRlbnRpdHkuaWRtLklkVHlwZQoKLyoKKiBEZWZpbmVkIHZhcmlhYmxlczoKKiBsb2dnZXIgLSBhbHdheXMgcHJlc2VudHMsIHRoZSAiT0F1dGgyUHJvdmlkZXIiIGRlYnVnIGxvZ2dlciBpbnN0YW5jZQoqIGNsYWltcyAtIGFsd2F5cyBwcmVzZW50LCBkZWZhdWx0IHNlcnZlciBwcm92aWRlZCBjbGFpbXMKKiBhY2Nlc3NUb2tlbiAtIGFsd2F5cyBwcmVzZW50LCB0aGUgT0F1dGgyIGFjY2VzcyB0b2tlbgoqIHNlc3Npb24gLSBwcmVzZW50IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIHRoZSBzZXNzaW9uIGNvb2tpZSwgdGhlIHVzZXIncyBzZXNzaW9uIG9iamVjdAoqIGlkZW50aXR5IC0gYWx3YXlzIHByZXNlbnQsIHRoZSBpZGVudGl0eSBvZiB0aGUgcmVzb3VyY2Ugb3duZXIKKiBzY29wZXMgLSBhbHdheXMgcHJlc2VudCwgdGhlIHJlcXVlc3RlZCBzY29wZXMKKiByZXF1ZXN0ZWRDbGFpbXMgLSBNYXA8U3RyaW5nLCBTZXQ8U3RyaW5nPj4KKiAgICAgICAgICAgICAgICAgIGFsd2F5cyBwcmVzZW50LCBub3QgZW1wdHkgaWYgdGhlIHJlcXVlc3QgY29udGFpbnMgYSBjbGFpbXMgcGFyYW1ldGVyIGFuZCBzZXJ2ZXIgaGFzIGVuYWJsZWQKKiAgICAgICAgICAgICAgICAgIGNsYWltc19wYXJhbWV0ZXJfc3VwcG9ydGVkLCBtYXAgb2YgcmVxdWVzdGVkIGNsYWltcyB0byBwb3NzaWJsZSB2YWx1ZXMsIG90aGVyd2lzZSBlbXB0eSwKKiAgICAgICAgICAgICAgICAgIHJlcXVlc3RlZCBjbGFpbXMgd2l0aCBubyByZXF1ZXN0ZWQgdmFsdWVzIHdpbGwgaGF2ZSBhIGtleSBidXQgbm8gdmFsdWUgaW4gdGhlIG1hcC4gQSBrZXkgd2l0aAoqICAgICAgICAgICAgICAgICAgYSBzaW5nbGUgdmFsdWUgaW4gaXRzIFNldCBpbmRpY2F0ZXMgdGhpcyBpcyB0aGUgb25seSB2YWx1ZSB0aGF0IHNob3VsZCBiZSByZXR1cm5lZC4KKiBSZXF1aXJlZCB0byByZXR1cm4gYSBNYXAgb2YgY2xhaW1zIHRvIGJlIGFkZGVkIHRvIHRoZSBpZF90b2tlbiBjbGFpbXMKKgoqIEV4cGVjdGVkIHJldHVybiB2YWx1ZSBzdHJ1dHVyZToKKi8KCi8vIHVzZXIgc2Vzc2lvbiBub3QgZ3VhcmFudGVlZCB0byBiZSBwcmVzZW50CmJvb2xlYW4gc2Vzc2lvblByZXNlbnQgPSBzZXNzaW9uICE9IG51bGwKCmRlZiBmcm9tU2V0ID0geyBjbGFpbSwgYXR0ciAtPgogICAgaWYgKGF0dHIgIT0gbnVsbCAmJiBhdHRyLnNpemUoKSA9PSAxKXsKICAgICAgICBhdHRyLml0ZXJhdG9yKCkubmV4dCgpCiAgICB9IGVsc2UgaWYgKGF0dHIgIT0gbnVsbCAmJiBhdHRyLnNpemUoKSA+IDEpewogICAgICAgIGF0dHIKICAgIH0gZWxzZSBpZiAobG9nZ2VyLndhcm5pbmdFbmFibGVkKCkpIHsKICAgICAgICBsb2dnZXIud2FybmluZygiT3BlbkFNU2NvcGVWYWxpZGF0b3IuZ2V0VXNlckluZm8oKTogR290IGFuIGVtcHR5IHJlc3VsdCBmb3IgY2xhaW09JGNsYWltIik7CiAgICB9Cn0KCmF0dHJpYnV0ZVJldHJpZXZlciA9IHsgYXR0cmlidXRlLCBjbGFpbSwgaWRlbnRpdHksIHJlcXVlc3RlZCAtPgogICAgaWYgKHJlcXVlc3RlZCA9PSBudWxsIHx8IHJlcXVlc3RlZC5pc0VtcHR5KCkpIHsKICAgICAgICBmcm9tU2V0KGNsYWltLCBpZGVudGl0eS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSkKICAgIH0gZWxzZSBpZiAocmVxdWVzdGVkLnNpemUoKSA9PSAxKSB7CiAgICAgICAgcmVxdWVzdGVkLml0ZXJhdG9yKCkubmV4dCgpCiAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJObyBzZWxlY3Rpb24gbG9naWMgZm9yICRjbGFpbSBkZWZpbmVkLiBWYWx1ZXM6ICRyZXF1ZXN0ZWQiKQogICAgfQp9CgovLyBbIHtjbGFpbX06IHthdHRyaWJ1dGUgcmV0cmlldmVyfSwgLi4uIF0KY2xhaW1BdHRyaWJ1dGVzID0gWwogICAgICAgICJlbWFpbCI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgibWFpbCIpLAogICAgICAgICJhZGRyZXNzIjogeyBjbGFpbSwgaWRlbnRpdHksIHJlcXVlc3RlZCAtPiBbICJmb3JtYXR0ZWQiIDogYXR0cmlidXRlUmV0cmlldmVyKCJwb3N0YWxhZGRyZXNzIiwgY2xhaW0sIGlkZW50aXR5LCByZXF1ZXN0ZWQpIF0gfSwKICAgICAgICAicGhvbmVfbnVtYmVyIjogYXR0cmlidXRlUmV0cmlldmVyLmN1cnJ5KCJ0ZWxlcGhvbmVudW1iZXIiKSwKICAgICAgICAiZ2l2ZW5fbmFtZSI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgiZ2l2ZW5uYW1lIiksCiAgICAgICAgInpvbmVpbmZvIjogYXR0cmlidXRlUmV0cmlldmVyLmN1cnJ5KCJwcmVmZXJyZWR0aW1lem9uZSIpLAogICAgICAgICJmYW1pbHlfbmFtZSI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgic24iKSwKICAgICAgICAibG9jYWxlIjogYXR0cmlidXRlUmV0cmlldmVyLmN1cnJ5KCJwcmVmZXJyZWRsb2NhbGUiKSwKICAgICAgICAibmFtZSI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgiY24iKSwKICAJCSJvY2VhbnJvbGVzIjogYXR0cmlidXRlUmV0cmlldmVyLmN1cnJ5KCJvY2VhbnJvbGVzIikKICAJLy8JIm9jZWFucm9sZXMiOiB7IGNsYWltLCBpZGVudGl0eSwgcmVxdWVzdGVkIC0+CiAgICAgIC8vICAgIGlkZW50aXR5LmdldE1lbWJlcnNoaXBzKElkVHlwZS5HUk9VUCkuY29sbGVjdCB7IGdyb3VwIC0+IGdyb3VwLm5hbWUgfX0KXQoKLy8ge3Njb3BlfTogWyB7Y2xhaW19LCAuLi4gXQpzY29wZUNsYWltc01hcCA9IFsKICAgICAgICAiZW1haWwiOiBbICJlbWFpbCIgXSwKICAgICAgICAiYWRkcmVzcyI6IFsgImFkZHJlc3MiIF0sCiAgICAgICAgInBob25lIjogWyAicGhvbmVfbnVtYmVyIiBdLAogICAgICAgICJwcm9maWxlIjogWyAiZ2l2ZW5fbmFtZSIsICJ6b25laW5mbyIsICJmYW1pbHlfbmFtZSIsICJsb2NhbGUiLCAibmFtZSIgXSwKICAJCSJvY2VhbnJvbGVzIjogWyAib2NlYW5yb2xlcyIgXQpdCgppZiAobG9nZ2VyLm1lc3NhZ2VFbmFibGVkKCkpIHsKICAgIHNjb3Blcy5maW5kQWxsIHsgcyAtPiAhKCJvcGVuaWQiLmVxdWFscyhzKSB8fCBzY29wZUNsYWltc01hcC5jb250YWluc0tleShzKSkgfS5lYWNoIHsgcyAtPgogICAgICAgIGxvZ2dlci5tZXNzYWdlKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOjpNZXNzYWdlOiBzY29wZSBub3QgYm91bmQgdG8gY2xhaW1zOiAkcyIpCiAgICB9Cn0KCmRlZiBjb21wdXRlQ2xhaW0gPSB7IGNsYWltLCByZXF1ZXN0ZWRWYWx1ZXMgLT4KICAgIHRyeSB7CiAgICAgICAgWyBjbGFpbSwgY2xhaW1BdHRyaWJ1dGVzLmdldChjbGFpbSkoY2xhaW0sIGlkZW50aXR5LCByZXF1ZXN0ZWRWYWx1ZXMpIF0KICAgIH0gY2F0Y2ggKElkUmVwb0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOiBVbmFibGUgdG8gcmV0cmlldmUgYXR0cmlidXRlPSRhdHRyaWJ1dGUiLCBlKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChTU09FeGNlcHRpb24gZSkgewogICAgICAgIGlmIChsb2dnZXIud2FybmluZ0VuYWJsZWQoKSkgewogICAgICAgICAgICBsb2dnZXIud2FybmluZygiT3BlbkFNU2NvcGVWYWxpZGF0b3IuZ2V0VXNlckluZm8oKTogVW5hYmxlIHRvIHJldHJpZXZlIGF0dHJpYnV0ZT0kYXR0cmlidXRlIiwgZSk7CiAgICAgICAgfQogICAgfQp9CgpkZWYgY29tcHV0ZWRDbGFpbXMgPSBzY29wZXMuZmluZEFsbCB7IHMgLT4gISJvcGVuaWQiLmVxdWFscyhzKSAmJiBzY29wZUNsYWltc01hcC5jb250YWluc0tleShzKSB9LmluamVjdChjbGFpbXMpIHsgbWFwLCBzIC0+CiAgICBzY29wZUNsYWltcyA9IHNjb3BlQ2xhaW1zTWFwLmdldChzKQogICAgbWFwIDw8IHNjb3BlQ2xhaW1zLmZpbmRBbGwgeyBjIC0+ICFyZXF1ZXN0ZWRDbGFpbXMuY29udGFpbnNLZXkoYykgfS5jb2xsZWN0RW50cmllcyhbOl0pIHsgY2xhaW0gLT4gY29tcHV0ZUNsYWltKGNsYWltLCBudWxsKSB9Cn0uZmluZEFsbCB7IG1hcCAtPiBtYXAudmFsdWUgIT0gbnVsbCB9IDw8IHJlcXVlc3RlZENsYWltcy5jb2xsZWN0RW50cmllcyhbOl0pIHsgY2xhaW0sIHJlcXVlc3RlZFZhbHVlIC0+CiAgICBjb21wdXRlQ2xhaW0oY2xhaW0sIHJlcXVlc3RlZFZhbHVlKQp9CgpkZWYgY29tcG9zaXRlU2NvcGVzID0gc2NvcGVDbGFpbXNNYXAuZmluZEFsbCB7IHNjb3BlIC0+CiAgICBzY29wZXMuY29udGFpbnMoc2NvcGUua2V5KQp9CgpyZXR1cm4gbmV3IFVzZXJJbmZvQ2xhaW1zKChNYXApY29tcHV0ZWRDbGFpbXMsIChNYXApY29tcG9zaXRlU2NvcGVzKQ==",
    "default" : true,
    "language" : "GROOVY",
    "context" : "OIDC_CLAIMS",
    "createdBy" : "null",
    "creationDate" : 0,
    "lastModifiedBy" : "null",
    "lastModifiedDate" : 0
  }
}